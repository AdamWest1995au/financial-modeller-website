<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questionnaire - The Financial Modeller</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #ffffff;
            background: #000000;
            background-image: radial-gradient(circle, rgba(255, 255, 255, 0.08) 1px, transparent 1px);
            background-size: 3.8px 3.8px;
            overflow-x: hidden;
            position: relative;
        }

        /* Mouse illumination effect */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            background: radial-gradient(circle 180px at var(--mouse-x, 50%) var(--mouse-y, 50%), 
                        rgba(139, 92, 246, 0.4) 0%, 
                        rgba(139, 92, 246, 0.25) 3%, 
                        rgba(139, 92, 246, 0.12) 8%, 
                        rgba(139, 92, 246, 0.06) 15%, 
                        rgba(139, 92, 246, 0.02) 25%, 
                        rgba(139, 92, 246, 0.005) 40%, 
                        transparent 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
            filter: blur(6px);
        }

        body.mouse-active::after {
            opacity: 1;
        }

        /* Enhanced dot illumination overlay */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
            background-image: radial-gradient(circle, rgba(139, 92, 246, 0.6) 1px, transparent 1px);
            background-size: 3.8px 3.8px;
            mask: radial-gradient(circle 120px at var(--mouse-x, 50%) var(--mouse-y, 50%), 
                  black 0%, 
                  black 2%, 
                  rgba(0,0,0,0.6) 6%, 
                  rgba(0,0,0,0.3) 12%, 
                  rgba(0,0,0,0.1) 20%, 
                  rgba(0,0,0,0.02) 35%, 
                  transparent 60%);
            -webkit-mask: radial-gradient(circle 120px at var(--mouse-x, 50%) var(--mouse-y, 50%), 
                         black 0%, 
                         black 2%, 
                         rgba(0,0,0,0.6) 6%, 
                         rgba(0,0,0,0.3) 12%, 
                         rgba(0,0,0,0.1) 20%, 
                         rgba(0,0,0,0.02) 35%, 
                         transparent 60%);
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        body.mouse-active::before {
            opacity: 1;
        }

        /* Mouse trail elements */
        .mouse-trail {
            position: fixed;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            opacity: 1;
            transition: opacity 0.8s ease-out;
        }

        .mouse-trail::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle 180px at var(--trail-x) var(--trail-y), 
                        rgba(139, 92, 246, 0.25) 0%, 
                        rgba(139, 92, 246, 0.15) 3%, 
                        rgba(139, 92, 246, 0.08) 8%, 
                        rgba(139, 92, 246, 0.04) 15%, 
                        rgba(139, 92, 246, 0.015) 25%, 
                        rgba(139, 92, 246, 0.003) 40%, 
                        transparent 100%);
            filter: blur(6px);
        }

        .mouse-trail::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            background-image: radial-gradient(circle, rgba(139, 92, 246, 0.4) 1px, transparent 1px);
            background-size: 3.8px 3.8px;
            mask: radial-gradient(circle 120px at var(--trail-x) var(--trail-y), 
                  black 0%, 
                  black 2%, 
                  rgba(0,0,0,0.4) 6%, 
                  rgba(0,0,0,0.2) 12%, 
                  rgba(0,0,0,0.08) 20%, 
                  rgba(0,0,0,0.015) 35%, 
                  transparent 60%);
            -webkit-mask: radial-gradient(circle 120px at var(--trail-x) var(--trail-y), 
                         black 0%, 
                         black 2%, 
                         rgba(0,0,0,0.4) 6%, 
                         rgba(0,0,0,0.2) 12%, 
                         rgba(0,0,0,0.08) 20%, 
                         rgba(0,0,0,0.015) 35%, 
                         transparent 60%);
        }

        .mouse-trail.fade-out {
            opacity: 0;
        }

        /* Country flag styles - moved from top */
        .country-flag, .country-option-flag {
            transition: opacity 0.2s ease;
        }

        .country-flag:not([src]), .country-option-flag:not([src]) {
            opacity: 0.5;
        }

        .country-flag:hover, .country-option-flag:hover {
            opacity: 0.8;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        /* Floating stats background */
        .floating-stats {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
            pointer-events: none;
        }

        /* Essential Modal Styles - Add to your existing CSS */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 2000;
    backdrop-filter: blur(10px);
}

.modal-overlay.active {
    display: flex;
}

.modal-overlay.question-mode {
    justify-content: center;
    align-items: center;
    background: rgba(0, 0, 0, 0.95);
}

.question-modal {
    background: rgba(0, 0, 0, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 16px;
    padding: 40px;
    width: 90vw;
    max-width: 800px;
    height: 90vh;
    max-height: 700px;
    overflow-y: auto;
    backdrop-filter: blur(20px);
    transform: scale(0.9);
    opacity: 0;
    transition: all 0.3s ease;
    position: relative;
    color: white;
}

.modal-overlay.active .question-modal {
    transform: scale(1);
    opacity: 1;
}

.modal-header {
    text-align: center;
    margin-bottom: 30px;
}

.modal-progress {
    width: 100%;
    height: 6px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 3px;
    overflow: hidden;
    margin-bottom: 20px;
}

.modal-progress-fill {
    height: 100%;
    background: linear-gradient(135deg, #8b5cf6 0%, #c084fc 100%);
    transition: width 0.5s ease;
    border-radius: 3px;
    width: 0%;
}

.modal-progress-text {
    text-align: center;
    margin-top: 8px;
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.85rem;
}

.question-header {
    margin-bottom: 30px;
}

.question-title {
    font-size: 1.8rem;
    color: #ffffff;
    margin-bottom: 10px;
    font-weight: 600;
}

.question-description {
    font-size: 1rem;
    color: rgba(255, 255, 255, 0.7);
    line-height: 1.5;
}

.question-content {
    margin-bottom: 30px;
    min-height: 200px;
}

.modal-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 20px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    gap: 15px;
}

.modal-btn {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    min-width: 100px;
}

.modal-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.modal-btn.primary {
    background: linear-gradient(135deg, #8b5cf6 0%, #c084fc 100%);
    color: white;
}

.modal-btn.primary:hover:not(:disabled) {
    background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
    transform: translateY(-2px);
}

.modal-btn.secondary {
    background: rgba(255, 255, 255, 0.1);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.modal-btn.secondary:hover {
    background: rgba(255, 255, 255, 0.2);
}

.loading-content {
    text-align: center;
    padding: 60px 20px;
    color: rgba(255, 255, 255, 0.7);
}

.skip-text {
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.5);
    text-align: center;
    flex: 1;
}

/* Debug styles */
.debug-output .success { color: #22c55e; }
.debug-output .warning { color: #f59e0b; }
.debug-output .error { color: #dc2626; }
.debug-output .info { color: #8b5cf6; }

        .floating-stat {
    position: absolute;
    font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', Roboto, sans-serif;
    font-size: 14px;
    color: rgba(139, 92, 246, 0.15);
    white-space: nowrap;
    animation: floatStat 20s linear infinite;
    will-change: transform;
    transition: all 0.8s ease;
    font-weight: 400;

    
}

.floating-stat.large {
    font-size: 18px;
    color: rgba(139, 92, 246, 0.12);
    font-weight: 500;
}

.floating-stat.small {
    font-size: 12px;
    color: rgba(139, 92, 246, 0.18);
    font-weight: 400;
}

/* Illuminated state */
.floating-stat.illuminated {
    color: rgba(139, 92, 246, 0.9) !important;
    text-shadow: 
        0 0 10px rgba(139, 92, 246, 0.8),
        0 0 20px rgba(139, 92, 246, 0.6),
        0 0 30px rgba(139, 92, 246, 0.4);
    font-weight: 600;
    transform: scale(1.05);
}

.floating-stat.illuminated.large {
    color: rgba(139, 92, 246, 0.95) !important;
    text-shadow: 
        0 0 15px rgba(139, 92, 246, 0.9),
        0 0 25px rgba(139, 92, 246, 0.7),
        0 0 35px rgba(139, 92, 246, 0.5);
}

.floating-stat.illuminated.small {
    color: rgba(139, 92, 246, 0.85) !important;
    text-shadow: 
        0 0 8px rgba(139, 92, 246, 0.7),
        0 0 15px rgba(139, 92, 246, 0.5),
        0 0 25px rgba(139, 92, 246, 0.3);
}

        @keyframes floatStat {
            0% {
                transform: translateY(100vh) translateX(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) translateX(50px);
                opacity: 0;
            }
        }

        @keyframes floatStatReverse {
            0% {
                transform: translateY(-100px) translateX(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) translateX(-50px);
                opacity: 0;
            }
        }

        .floating-stat.reverse {
            animation-name: floatStatReverse;
        }

        /* Purple glow orb */
        .glow-orb {
            position: fixed;
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, rgba(139, 92, 246, 0.3) 0%, transparent 70%);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 0;
            filter: blur(100px);
            pointer-events: none;
        }

        /* Header Styles */
        .header {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 80px;
        }

        .logo {
            font-size: 1.5rem !important;
            font-weight: 400 !important;
            color: rgba(255, 255, 255, 0.9) !important;
            text-decoration: none !important;
            display: inline-flex !important;
            align-items: center !important;
            gap: 16px !important;
            letter-spacing: -0.03em !important;
            cursor: pointer !important;
        }

        .logo:hover, 
        .logo:focus, 
        .logo:active,
        .logo:visited {
            text-decoration: none !important;
            color: rgba(255, 255, 255, 0.9) !important;
        }

        .dot-grid {
            width: 48px;
            height: 36px;
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            grid-template-rows: repeat(8, 1fr);
            gap: 0.5px;
            position: relative;
            transform: perspective(200px) rotateY(-15deg);
        }

        .dot {
            width: 2px;
            height: 2px;
            background: #8b5cf6;
            border-radius: 50%;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            transform-origin: center;
            opacity: 0.3;
            transform: scale(0.6);
            background: linear-gradient(90deg, #6d28d9 0%, #8b5cf6 50%, #a78bfa 100%);
        }

        /* Wave pattern - each column has different heights */
        .dot-grid .dot:nth-child(12n+1) { opacity: 0.2; transform: scale(0.5); }
        .dot-grid .dot:nth-child(12n+2) { opacity: 0.3; transform: scale(0.6); }
        .dot-grid .dot:nth-child(12n+3) { opacity: 0.4; transform: scale(0.7); }
        .dot-grid .dot:nth-child(12n+4) { opacity: 0.5; transform: scale(0.8); }
        .dot-grid .dot:nth-child(12n+5) { opacity: 0.6; transform: scale(0.9); }
        .dot-grid .dot:nth-child(12n+6) { opacity: 0.8; transform: scale(1.1); }
        .dot-grid .dot:nth-child(12n+7) { opacity: 0.9; transform: scale(1.2); }
        .dot-grid .dot:nth-child(12n+8) { opacity: 1; transform: scale(1.3); }
        .dot-grid .dot:nth-child(12n+9) { opacity: 0.9; transform: scale(1.2); }
        .dot-grid .dot:nth-child(12n+10) { opacity: 0.7; transform: scale(1); }
        .dot-grid .dot:nth-child(12n+11) { opacity: 0.5; transform: scale(0.8); }
        .dot-grid .dot:nth-child(12n+12) { opacity: 0.3; transform: scale(0.6); }

        .logo span {
            font-size: 1.5rem;
            font-weight: 400;
            color: rgba(255, 255, 255, 0.9);
            letter-spacing: -0.03em;
            white-space: nowrap;
            text-decoration: none;
        }

        /* Hover state for the entire logo */
        .logo:hover .dot-grid {
            transform: perspective(200px) rotateY(-10deg) scale(1.05);
        }

        .logo:hover .dot {
            animation: wave 2s ease-in-out infinite;
        }

        @keyframes wave {
            0%, 100% {
                transform: scale(var(--scale, 1)) translateY(0);
                opacity: var(--opacity, 0.6);
            }
            50% {
                transform: scale(calc(var(--scale, 1) * 1.3)) translateY(-2px);
                opacity: calc(var(--opacity, 0.6) * 1.2);
            }
        }

        /* Stagger the animation for wave effect */
        .logo:hover .dot { animation-delay: calc(var(--delay, 0) * 1s); }

        /* Add subtle glow effect on hover */
        .logo:hover .dot-grid {
            filter: drop-shadow(0 0 15px rgba(139, 92, 246, 0.3));
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 40px;
            align-items: center;
        }

        .nav-links a {
            text-decoration: none;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 400;
            font-size: 0.95rem;
            transition: color 0.3s ease;
        }

        .nav-links a:hover {
            color: #ffffff;
        }

        /* Book a call button */
        .book-call-btn {
            background: #8b5cf6;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 500;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            border: 1px solid #8b5cf6;
        }

        .book-call-btn:hover {
            background: #7c3aed;
            transform: translateY(-1px);
            box-shadow: 0 4px 20px rgba(139, 92, 246, 0.4);
        }

        /* NEW CSS - REPLACE WITH THIS */
.hero {
    position: relative;
    padding: 120px 20px 80px;
    z-index: 2;
    min-height: 90vh;
    display: flex;
    align-items: center;
    justify-content: center;
}

.hero-content {
    max-width: 1200px;
    margin: 0 auto;
    position: relative;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 80px;
    align-items: center;
}

.hero-text {
    text-align: left;
}

.hero h1 {
    font-size: 3.5rem;
    margin-bottom: 24px;
    font-weight: 600;
    line-height: 1.1;
    letter-spacing: -0.02em;
}

.hero p {
    font-size: 1.25rem;
    margin-bottom: 40px;
    color: rgba(255, 255, 255, 0.7);
    line-height: 1.6;
}

        .btn {
            padding: 14px 32px;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.95rem;
            position: relative;
            overflow: hidden;
            z-index: 1;
            cursor: pointer;
            border: none;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 100%;
            background: #8b5cf6;
            transition: width 0.4s ease;
            z-index: -1;
        }

        .btn:hover::before {
            width: 100%;
        }

        .btn::after {
            content: '';
            font-size: 1.1em;
            transition: transform 0.3s ease;
        }

        .btn.btn-next::after {
            content: '→';
        }

        .btn.btn-back::after {
            content: '';
        }

        .btn.btn-back::before {
            content: '←';
            position: static;
            width: auto;
            height: auto;
            background: none;
            transition: transform 0.3s ease;
            z-index: auto;
        }

        .btn:hover::after {
            transform: translateX(3px);
        }

        .btn.btn-back:hover::before {
            transform: translateX(-3px);
        }

        .btn.btn-back:hover::after {
            transform: none;
        }

        .btn-primary {
            background: transparent;
            color: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-primary:hover {
            color: white;
            border-color: #8b5cf6;
            transform: translateY(-1px);
            box-shadow: 0 4px 20px rgba(139, 92, 246, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Progress Bar */
        .progress-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 100;
            display: none; /* Hidden by default, shown when questionnaire starts */
        }

        .progress-container.active {
            display: block;
        }

        /* Animated Panes Styles */
/* NEW CSS - REPLACE ALL THE OLD ANIMATED PANES CSS WITH THIS */
.animated-panes-container {
    display: flex;
    justify-content: center;
    align-items: center;
    perspective: 1200px;
    perspective-origin: center center;
    margin: 60px 0;
}

.pane-stack {
    position: relative;
    width: 500px;
    height: 350px;
    display: flex;
    justify-content: center;
    align-items: center;
    transform-style: preserve-3d;
    transform: rotateX(6deg) rotateY(8deg);
}

.model-pane {
    position: absolute;
    width: 280px;
    height: 180px;
    border-radius: 16px;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: flex-start;
    padding: 20px;
    color: white;
    font-weight: 600;
    font-size: 16px;
    box-shadow: 
        0 20px 40px rgba(0, 0, 0, 0.4),
        0 10px 20px rgba(0, 0, 0, 0.3);
    transform-origin: center center;
    transition: all 0.6s cubic-bezier(0.4, 0.0, 0.2, 1);
    will-change: transform;
    backface-visibility: hidden;
    cursor: default;
    user-select: none;
    border: 1px solid rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(15px);
    box-sizing: border-box;
}

/* Panel 1 - Deep Purple Hue */
.model-pane:nth-child(1) {
    background: linear-gradient(135deg, 
        rgba(91, 33, 182, 0.3) 0%, 
        rgba(124, 58, 237, 0.2) 100%);
    border-color: rgba(91, 33, 182, 0.4);
    z-index: 4;
    transform: translate3d(0px, 0px, 40px) rotateY(5deg) rotateX(2deg);
    box-shadow: 
        0 20px 40px rgba(91, 33, 182, 0.3),
        0 10px 20px rgba(91, 33, 182, 0.2);
}

/* Panel 2 - Purple to Magenta Hue */
.model-pane:nth-child(2) {
    background: linear-gradient(135deg, 
        rgba(139, 92, 246, 0.3) 0%, 
        rgba(236, 72, 153, 0.2) 100%);
    border-color: rgba(139, 92, 246, 0.4);
    z-index: 3;
    transform: translate3d(-35px, -22px, 20px) rotateY(5deg) rotateX(2deg);
    box-shadow: 
        0 20px 40px rgba(139, 92, 246, 0.3),
        0 10px 20px rgba(236, 72, 153, 0.2);
}

/* Panel 3 - Magenta Hue */
.model-pane:nth-child(3) {
    background: linear-gradient(135deg, 
        rgba(236, 72, 153, 0.3) 0%, 
        rgba(219, 39, 119, 0.2) 100%);
    border-color: rgba(236, 72, 153, 0.4);
    z-index: 2;
    transform: translate3d(-70px, -44px, 0px) rotateY(5deg) rotateX(2deg);
    box-shadow: 
        0 20px 40px rgba(236, 72, 153, 0.3),
        0 10px 20px rgba(219, 39, 119, 0.2);
}

/* Panel 4 - Light Purple Hue */
.model-pane:nth-child(4) {
    background: linear-gradient(135deg, 
        rgba(196, 181, 253, 0.2) 0%, 
        rgba(167, 139, 250, 0.15) 100%);
    border-color: rgba(196, 181, 253, 0.3);
    color: rgba(255, 255, 255, 0.9);
    z-index: 1;
    transform: translate3d(-105px, -66px, -20px) rotateY(5deg) rotateX(2deg);
    box-shadow: 
        0 20px 40px rgba(196, 181, 253, 0.2),
        0 10px 20px rgba(167, 139, 250, 0.15);
}

/* Panel title - now at the top */
.pane-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: inherit;
    text-align: left;
    line-height: 1.2;
    margin-bottom: 16px;
}

/* Panel content area */
.pane-content {
    flex: 1;
    width: 100%;
    opacity: 0;
    display: block;
    transition: opacity 0.3s ease;
}

/* Bullet points */
.bullet-point {
    font-size: 0.85rem;
    font-weight: 400;
    color: rgba(255, 255, 255, 0.8);
    line-height: 1.4;
    margin-bottom: 8px;
    opacity: 0;
    transform: translateY(10px);
    transition: all 0.3s ease;
    min-height: 1.2em;
    display: block;
}

.bullet-point:last-child {
    margin-bottom: 0;
}

/* Sliding out animation */
.model-pane.sliding-out {
    transform: translate3d(-500px, 0px, 100px) rotateY(35deg) rotateX(15deg) !important;
    opacity: 0.3;
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
    .model-pane {
        transition: opacity 0.2s linear;
    }
    .model-pane.sliding-out {
        transform: none !important;
        opacity: 0;
    }
}

/* Hover effect for container */
.pane-stack:hover .model-pane {
    transform: translate3d(
        calc(var(--x) * 1.1), 
        calc(var(--y) * 1.1), 
        calc(var(--z) * 1.1)
    ) rotateY(5deg) rotateX(2deg);
}

.pane-stack:hover .model-pane:nth-child(1) {
    box-shadow: 
        0 30px 60px rgba(91, 33, 182, 0.4),
        0 15px 30px rgba(91, 33, 182, 0.3);
}

.pane-stack:hover .model-pane:nth-child(2) {
    box-shadow: 
        0 30px 60px rgba(139, 92, 246, 0.4),
        0 15px 30px rgba(236, 72, 153, 0.3);
}

.pane-stack:hover .model-pane:nth-child(3) {
    box-shadow: 
        0 30px 60px rgba(236, 72, 153, 0.4),
        0 15px 30px rgba(219, 39, 119, 0.3);
}

.pane-stack:hover .model-pane:nth-child(4) {
    box-shadow: 
        0 30px 60px rgba(196, 181, 253, 0.3),
        0 15px 30px rgba(167, 139, 250, 0.2);
}

/* Responsive Design for Animated Panes */
@media (max-width: 1024px) {
    .pane-stack {
        width: 450px;
        height: 300px;
    }

    .model-pane {
        width: 250px;
        height: 160px;
        padding: 18px;
        font-size: 15px;
    }

    .pane-title {
        font-size: 1rem;
        margin-bottom: 12px;
    }

    .bullet-point {
        font-size: 0.75rem;
        margin-bottom: 6px;
        opacity: 0;
        transform: translateY(10px);
    }
    .hero-content {
        gap: 60px;
    }

    .hero h1 {
        font-size: 3rem;
    }
}

@media (max-width: 768px) {
    .pane-stack {
        width: 350px;
        height: 250px;
        transform: rotateX(4deg) rotateY(6deg);
    }
    
    .model-pane {
        width: 220px;
        height: 140px;
        padding: 16px;
        font-size: 14px;
    }
    
    .pane-title {
        font-size: 0.9rem;
        margin-bottom: 10px;
    }

    .bullet-point {
        font-size: 0.7rem;
        margin-bottom: 5px;
        opacity: 0;
        transform: translateY(10px);
    }

    /* Adjust 3D transforms for mobile */
    .model-pane:nth-child(1) {
        transform: translate3d(0px, 0px, 30px) rotateY(4deg) rotateX(1deg);
    }

    .model-pane:nth-child(2) {
        transform: translate3d(-28px, -18px, 15px) rotateY(4deg) rotateX(1deg);
    }

    .model-pane:nth-child(3) {
        transform: translate3d(-56px, -36px, 0px) rotateY(4deg) rotateX(1deg);
    }

    .model-pane:nth-child(4) {
        transform: translate3d(-84px, -54px, -15px) rotateY(4deg) rotateX(1deg);
    }

    .hero-content {
        grid-template-columns: 1fr;
        gap: 40px;
        text-align: center;
    }

    .hero-text {
        text-align: center;
        order: 2;
    }

    .animated-panes-container {
        order: 1;
    }

    .hero h1 {
        font-size: 2.5rem;
    }

    .hero p {
        font-size: 1.1rem;
    }

    .hero-buttons {
        justify-content: center;
    }
    
    .btn {
        width: 100%;
        max-width: 300px;
    }
}

@media (max-width: 480px) {
    .pane-stack {
        width: 300px;
        height: 200px;
    }
    
    .model-pane {
        width: 180px;
        height: 120px;
        padding: 14px;
        font-size: 12px;
    }
    
    .pane-title {
        font-size: 0.8rem;
        margin-bottom: 8px;
    }

    .bullet-point {
        font-size: 0.65rem;
        margin-bottom: 4px;
        opacity: 0;
        transform: translateY(10px);
    }
}

/* NEW CSS - REPLACE WITH THIS */
.hero-buttons {
    display: flex;
    gap: 16px;
    justify-content: flex-start;
    flex-wrap: wrap;
    width: 100%;
}

.btn {
    flex: 1;
    min-width: 180px;
}

.btn-secondary-alt {
    background: transparent;
    color: rgba(139, 92, 246, 0.9);
    border: 1px solid rgba(139, 92, 246, 0.5);
}

.btn-secondary-alt:hover {
    background: rgba(139, 92, 246, 0.1);
    color: #8b5cf6;
    transform: translateY(-1px);
    box-shadow: 0 4px 20px rgba(139, 92, 246, 0.4);
}

@media (max-width: 768px) {
    .hero-buttons {
        flex-direction: column;
        align-items: center;
    }
    
    .btn {
        width: 100%;
        max-width: 300px;
    }
    
}

.progress-container.active {
    display: block;
}

        /* Progress Bar inside Modal */
        .modal-progress-container {
    margin-bottom: 0px;     /* Reduced to bring time box closer */
    position: relative;
    z-index: 1;
    max-width: 900px;
    margin-left: auto;
    margin-right: auto;
}

        .modal-progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .modal-progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #8b5cf6 0%, #c084fc 100%);
            transition: width 0.5s ease;
            border-radius: 3px;
        }

        .modal-progress-text {
            text-align: center;
            margin-top: 8px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.85rem;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #8b5cf6 0%, #c084fc 100%);
            transition: width 0.5s ease;
            border-radius: 4px;
        }

        .progress-text {
            text-align: center;
            margin-top: 10px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }

        /* Information Pane Modal Styles */
        .info-pane-modal {
    background: rgba(0, 0, 0, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 30px 40px; /* Reduced from 40px 60px */
    width: 90vw;
    height: 90vh;
    max-width: none;
    max-height: none;
    overflow-y: auto;
    backdrop-filter: blur(20px);
    transform: scale(0.9);
    opacity: 0;
    transition: all 0.3s ease;
    position: relative;
}

        .modal-overlay.active .info-pane-modal {
            transform: scale(1);
            opacity: 1;
        }

        .info-pane-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .info-pane-title {
    font-size: 1.9rem; /* Reduced from 2.2rem */
    color: #ffffff;
    margin-bottom: 8px; /* Reduced margin */
    font-weight: 600;
}

.info-pane-subtitle {
    font-size: 0.95rem; /* Reduced from 1.1rem */
    color: rgba(255, 255, 255, 0.6);
}

        .info-pane-content {
            display: flex;
            flex-direction: column;
            gap: 60px;
        }

        .info-section {
            position: relative;
        }

        .section-title {
    font-size: 1.4rem; /* Reduced from 1.6rem */
    color: #ffffff;
    margin-bottom: 20px; /* Reduced from 30px */
    font-weight: 600;
}

        /* Question Types Grid */
        .question-types-grid {
            display: flex;
            flex-direction: column;
            gap: 40px;
        }

        .question-type-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 40px;
    align-items: center;
    padding: 30px;
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;
    position: relative;
}

/* Add purple glow on hover */
.question-type-row:hover {
    border-color: rgba(139, 92, 246, 0.5);
    box-shadow: 0 0 30px rgba(139, 92, 246, 0.3);
    background: rgba(139, 92, 246, 0.05);
}

        .question-type-info {
            padding-right: 20px;
        }

        .question-type-title {
    font-size: 1.15rem;
    color: rgba(255, 255, 255, 0.5); /* Faint by default */
    margin-bottom: 10px;
    font-weight: 600;
    transition: color 0.3s ease;
}

.question-type-description {
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.4); /* Even fainter */
    line-height: 1.5;
    transition: color 0.3s ease;
}

/* Make text bright white on hover */
.question-type-row:hover .question-type-title {
    color: #ffffff;
}

.question-type-row:hover .question-type-description {
    color: rgba(255, 255, 255, 0.9);
}

        .question-type-animation {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: auto; /* Remove default min-height */
    padding: 10px 0; /* Reduced padding */
}

/* Different heights for each animation type - More specific selectors */
.question-type-animation:has(#dropdownAnimation) {
    min-height: 220px;
    padding: 20px 0;
}

.question-type-animation:has(#toggleAnimation) {
    min-height: 60px;
    padding: 10px 0;
}

.question-type-animation:has(#freeTextAnimation) {
    min-height: 90px;
    padding: 15px 0;
}

/* Ensure the containers themselves don't override */
#dropdownAnimation {
    height: 100%;
    min-height: inherit;
}

#toggleAnimation {
    height: 100%;
    min-height: inherit;
    max-width: 250px;
}

#freeTextAnimation {
    height: 100%;
    min-height: inherit;
    max-width: 300px;
}

/* Keep the specific element styles */
.animation-container {
    width: 100%;
    max-width: 400px;
}

#toggleAnimation .animation-container,
#freeTextAnimation .animation-container {
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

#toggleAnimation .demo-toggle {
    height: 32px;
}

#freeTextAnimation .demo-input {
    padding: 8px 15px;
    font-size: 0.9rem;
}

#freeTextAnimation .demo-validation-message {
    margin-top: 4px;
    font-size: 0.75rem;
}

        /* Demo Dropdown Styles */
.demo-dropdown {
    position: relative;
    margin-bottom: 20px;
}

.demo-custom-indicator {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    margin-top: 8px;
    padding: 8px 12px;
    background: rgba(139, 92, 246, 0.2);
    border: 1px solid rgba(139, 92, 246, 0.3);
    border-radius: 6px;
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.85rem;
    font-style: italic;
    display: none;
    transition: all 0.3s ease;
}

.demo-custom-indicator.show {
    display: block;
}

.demo-dropdown-input.demo-custom-input {
    transition: all 0.3s ease;
}

/* Fix z-index for dropdown animation in info pane */
.question-type-animation {
    position: relative;
    z-index: 1;
}

.demo-dropdown {
    position: relative;
}

.demo-dropdown-options {
    position: absolute !important;
    z-index: 99999 !important;
    background: rgba(0, 0, 0, 0.95) !important;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5) !important;
}

/* Ensure the animation container doesn't clip children */
.animation-container {
    position: relative;
    overflow: visible !important;
}

/* Make sure parent containers don't clip */
.question-type-row {
    position: relative;
    overflow: visible !important;
}

.question-types-grid {
    overflow: visible !important;
}
        .demo-dropdown-input {
            width: 100%;
            padding: 15px 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.05);
            color: #ffffff;
            font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', Roboto, sans-serif;
        }

        .demo-dropdown-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 150px;
            overflow-y: auto;
            display: none;
            backdrop-filter: blur(20px);
        }

        .demo-dropdown-option {
            padding: 12px 20px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
        }

        .demo-dropdown-option:hover {
            background-color: rgba(139, 92, 246, 0.2);
            color: #ffffff;
        }

        .demo-dropdown-option.selected {
            background-color: rgba(34, 197, 94, 0.2);
            color: #ffffff;
            border-left: 3px solid #22c55e;
        }

        /* Demo Toggle Styles */
        .demo-toggle {
    position: relative;
    display: flex;
    width: 200px;
    height: 40px;
    background: #2a2a2a;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 1px solid rgba(255, 255, 255, 0.1);
    overflow: hidden;
}

.demo-toggle::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 50%;
    height: 100%;
    background: #8b5cf6;
    border-radius: 20px;
    transition: transform 0.5s ease;
    z-index: 1;
    box-shadow: 0 0 20px rgba(139, 92, 246, 0.4);
    transform: translateX(0);
}

.demo-toggle.active::before {
    transform: translateX(100%);
}

        .demo-toggle-labels {
            display: flex;
            width: 100%;
            height: 100%;
            position: relative;
            z-index: 2;
        }

        .demo-toggle-label {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            color: rgba(255, 255, 255, 0.4);
        }

        .demo-toggle-label:first-child {
            color: #ffffff;
        }

        /* Demo Input Styles */
        .demo-input {
            width: 100%;
            padding: 15px 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.05);
            color: #ffffff;
            font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', Roboto, sans-serif;
            text-align: center;
            transition: all 0.3s ease;
        }

        .demo-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .demo-input.invalid {
            border-color: #dc2626;
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.2);
            background: rgba(220, 38, 38, 0.1);
            color: #fecaca;
        }

        .demo-validation-message {
            margin-top: 8px;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.5);
            text-align: center;
            transition: all 0.3s ease;
        }

        .demo-validation-message.error {
            color: #fca5a5;
        }

        /* Questionnaire Design Section */
        .design-section {
    display: grid;
    grid-template-columns: 80px 1fr;
    gap: 40px;
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 30px;
    backdrop-filter: blur(10px);
    align-items: start;
}

.design-content {
    padding: 0;
}

        .design-sidebar {
    display: flex;
    flex-direction: column;
    gap: 0;
    padding-top: 0;
    position: relative;
    height: 100%;
}

.design-dot {
    position: absolute;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 60px;
    height: 60px;
    left: 0;
    z-index: 10; /* Increased z-index */
}

/* Calculate positions based on text section heights */
.design-dot:nth-child(1) { top: 10%; }
.design-dot:nth-child(2) { top: 32%; }
.design-dot:nth-child(3) { top: 54%; }
.design-dot:nth-child(4) { top: 76%; }

        .dot-number {
    position: relative;
    color: rgba(255, 255, 255, 0.6); /* Same as text color */
    font-size: 1.2rem;
    font-weight: 600;
    z-index: 5;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

        .dot-circle {
    position: absolute;
    width: 50px;
    height: 50px;
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    transition: all 0.3s ease;
    background: #000000;
    z-index: 1; /* Behind the number */
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Larger background to hide the line */
.dot-circle::before {
    content: '';
    position: absolute;
    width: 70px;
    height: 70px;
    background: #000000;
    border-radius: 50%;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: -2; /* Behind everything */
}

        .design-dot:hover .dot-circle,
.design-dot.active .dot-circle {
    border-color: #8b5cf6;
    background: rgba(139, 92, 246, 0.1);
    box-shadow: 0 0 20px rgba(139, 92, 246, 0.4);
}

.design-dot:hover .dot-circle::before,
.design-dot.active .dot-circle::before {
    background: #000000;
}

        .design-dot:hover .dot-number,
.design-dot.active .dot-number {
    color: #8b5cf6;
}

/* Default state - ensure numbers are faint like text */
.design-dot .dot-number {
    color: rgba(255, 255, 255, 0.5); /* Match the text opacity */
}
        .design-content {
            padding: 20px 0;
        }

        .design-text-section {
    display: flex;
    flex-direction: column;
    justify-content: center;
    opacity: 0.3;
    transition: all 0.3s ease;
    color: rgba(255, 255, 255, 0.5);
    padding: 15px 0; /* Reduced padding */
    position: relative;
    min-height: 80px; /* Reduced from 100px */
}

/* Ensure headers are also faint by default */
.design-text-section h4 {
    color: rgba(255, 255, 255, 0.5);
    transition: color 0.3s ease;
    margin-bottom: 10px; /* Reduced from 15px */
    margin-top: 0;
}

.design-text-section:not(:last-child)::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: rgba(255, 255, 255, 0.1);
}

.design-text-section.active {
    opacity: 1;
    color: #ffffff;
}

.design-text-section h4 {
    transition: color 0.3s ease;
    margin-bottom: 15px;
    margin-top: 0;
}

.design-text-section.active h4 {
    color: #ffffff;
}

.design-text-section p {
    margin-bottom: 0;
    line-height: 1.6;
}

/* Line between dots */
.design-sidebar::before {
    content: '';
    position: absolute;
    left: 30px;
    top: 15%; /* Increased from 12.5% */
    bottom: 20%; /* Increased from 12.5% to shorten the line more at bottom */
    width: 2px;
    background: linear-gradient(to bottom, 
        rgba(255, 255, 255, 0.1) 0%,
        rgba(139, 92, 246, 0.3) 50%,
        rgba(255, 255, 255, 0.1) 100%);
    z-index: 0; /* Behind everything */
}

.design-sidebar {
    position: relative;
}

        .design-text-section h4 {
            font-size: 1.3rem;
            color: #ffffff;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .design-text-section p {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.6;
        }

        .info-pane-actions {
            margin-top: 40px;
            text-align: center;
        }

        /* Responsive Design for Info Pane */
        @media (max-width: 768px) {
            .question-type-row {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .question-type-animation {
                margin-top: 20px;
            }

            .design-section {
                grid-template-columns: 60px 1fr;
                gap: 20px;
                padding: 20px;
            }

            .design-dot {
                width: 40px;
                height: 40px;
            }

            .dot-circle {
                width: 35px;
                height: 35px;
            }

            .dot-number {
                font-size: 1rem;
            }
        }

        /* Animation classes */
        @keyframes typeText {
            0% { width: 0; }
            100% { width: 100%; }
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .typing-animation {
            overflow: hidden;
            white-space: nowrap;
            animation: typeText 2s steps(30) forwards;
            position: relative;
        }

        .typing-animation::after {
            content: '|';
            position: absolute;
            right: 0;
            animation: blink 1s infinite;
        }

        /* reCAPTCHA Modal */
        .recaptcha-modal {
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            backdrop-filter: blur(20px);
            transform: scale(0.8);
            opacity: 0;
            transition: all 0.3s ease;
            position: relative;
            text-align: center;
        }

        .recaptcha-modal::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at top left, rgba(139, 92, 246, 0.1), transparent 50%);
            opacity: 0.3;
            border-radius: 16px;
        }

        .modal-overlay.active .recaptcha-modal {
            transform: scale(1);
            opacity: 1;
        }

        .recaptcha-header {
            margin-bottom: 30px;
            position: relative;
            z-index: 1;
        }

        .recaptcha-icon {
            display: inline-block;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #8b5cf6 0%, #c084fc 100%);
            color: white;
            border-radius: 50%;
            line-height: 60px;
            font-size: 1.5rem;
            margin-bottom: 20px;
        }

        .recaptcha-title {
            font-size: 1.6rem;
            color: #ffffff;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .recaptcha-description {
            color: rgba(255, 255, 255, 0.6);
            font-size: 1rem;
            line-height: 1.5;
        }

        .recaptcha-content {
            margin-bottom: 30px;
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .recaptcha-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 78px; /* Height of reCAPTCHA widget */
        }

        .recaptcha-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            align-items: center;
            position: relative;
            z-index: 1;
        }

        /* Submission reCAPTCHA Modal */
        .submission-recaptcha-modal {
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            backdrop-filter: blur(20px);
            transform: scale(0.8);
            opacity: 0;
            transition: all 0.3s ease;
            position: relative;
            text-align: center;
        }

        .submission-recaptcha-modal::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at top left, rgba(139, 92, 246, 0.1), transparent 50%);
            opacity: 0.3;
            border-radius: 16px;
        }

        .modal-overlay.active .submission-recaptcha-modal {
            transform: scale(1);
            opacity: 1;
        }

        .submission-loading {
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.1rem;
            padding: 20px;
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top-color: #8b5cf6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Question Modal */
        .question-modal {
    background: rgba(0, 0, 0, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 40px 60px;
    width: 90vw;
    height: 90vh;
    max-width: none;
    max-height: none;
    overflow-y: auto;
    overflow-x: hidden;
    backdrop-filter: blur(20px);
    transform: translateY(20px);
    opacity: 0;
    transition: all 0.3s ease;
    position: relative;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
}

        .question-modal::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at top left, rgba(139, 92, 246, 0.1), transparent 50%);
            opacity: 0.3;
            border-radius: 12px;
        }

        .modal-overlay.active .question-modal {
            transform: translateY(0);
            opacity: 1;
        }

        .question-header {
            text-align: left; /* Changed from center to left */
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .question-number {
            display: none;
        }

        .question-title {
            font-size: 1.4rem;
            color: #ffffff;
            margin-bottom: 10px;
            font-weight: 600;
            margin-top: 0;
        }

        .question-description {
    color: rgba(255, 255, 255, 0.6);
    font-size: 1rem;
    line-height: 1.5;
    margin: 0;
}

        .question-content {
            margin-bottom: 30px;
            position: relative;
            z-index: 1;
        }

        /* Extra spacing for user info form to accommodate dropdowns */
        .user-info-form {
            margin-bottom: 60px;
        }

        .input-container {
            position: relative;
        }

        /* ... [rest of the extensive CSS remains the same] ... */

        /* Force pane content to be hidden by default */
        .pane-content {
            opacity: 0 !important;
            transition: opacity 0.5s ease !important;
        }

        .bullet-point {
            opacity: 0 !important;
            transform: translateY(10px) !important;
            transition: all 0.4s ease !important;
        }

        /* When JavaScript sets opacity: 1, this will override */
        .pane-content[style*="opacity: 1"] {
            opacity: 1 !important;
        }

        .bullet-point[style*="opacity: 1"] {
            opacity: 1 !important;
            transform: translateY(0) !important;
        }
    </style>
</head>
<body>
    
    <!-- Floating Stats Background -->
    <div class="floating-stats" id="floatingStats"></div>

    <!-- Header -->
    <header class="header">
        <nav class="nav-container">
            <a href="../../index.html" class="logo" id="logo">
                <div class="dot-grid" id="dotGrid">
                    <!-- Dots will be generated by JavaScript -->
                </div>
                <span>The Financial Modeller</span>
            </a>
            <ul class="nav-links">
                <li><a href="../../index.html">Home</a></li>
                <li><a href="#" data-modal="templates" onclick="showModal('templates'); return false;">Model Templates</a></li>
                <li><a href="#" data-modal="how-it-works" onclick="showModal('how-it-works'); return false;">How it works</a></li>
                <li><a href="#" data-modal="pricing" onclick="showModal('pricing'); return false;">Pricing</a></li>
                <li><a href="#" data-modal="about" onclick="showModal('about'); return false;">About</a></li>
                <li><a href="https://www.thefinancialmodeller.com/pages/contact" class="book-call-btn">Contact us</a></li>
            </ul>
        </nav>
    </header>

    <!-- NEW HTML STRUCTURE -->
<section class="hero">
    <div class="hero-content">
        <!-- Animated Page Panes - Left Side -->
        <div class="animated-panes-container">
            <div class="pane-stack" id="paneStack">
                <div class="model-pane" data-index="0" style="--x: 0px; --y: 0px; --z: 40px;">
                    <div class="pane-title">Revenue Questions</div>
                    <div class="pane-content">
                        <div class="bullet-point">• What are your revenue streams?</div>
                        <div class="bullet-point">• How do you price your products?</div>
                        <div class="bullet-point">• What drives customer growth?</div>
                    </div>
                </div>
                <div class="model-pane" data-index="1" style="--x: -35px; --y: -22px; --z: 20px;">
                    <div class="pane-title">Operations</div>
                    <div class="pane-content">
                        <div class="bullet-point">• What are your key cost drivers?</div>
                        <div class="bullet-point">• How many employees do you have?</div>
                        <div class="bullet-point">• What's your operational structure?</div>
                    </div>
                </div>
                <div class="model-pane" data-index="2" style="--x: -70px; --y: -44px; --z: 0px;">
                    <div class="pane-title">Assets</div>
                    <div class="pane-content">
                        <div class="bullet-point">• What equipment do you need?</div>
                        <div class="bullet-point">• Do you own or lease property?</div>
                        <div class="bullet-point">• What's your inventory model?</div>
                    </div>
                </div>
                <div class="model-pane" data-index="3" style="--x: -105px; --y: -66px; --z: -20px;">
                    <div class="pane-title">Modelling Purpose</div>
                    <div class="pane-content">
                        <div class="bullet-point">• Are you seeking investment?</div>
                        <div class="bullet-point">• Planning for growth scenarios?</div>
                        <div class="bullet-point">• Need financial projections?</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Text Content - Right Side -->
        <div class="hero-text">
            <h1>Build your financial model</h1>
            <p>Take our dynamic questionnaire so we can digest and analyze your business model to build you a comprehensive financial model within minutes. If you're short on time try our new AI integration to fast track the process allowing you to link your website or describe your business in your own words.</p>
            
            <!-- Action Buttons -->
            <div class="hero-buttons">
                <button class="btn btn-primary" onclick="showInfoPane()">Take the Questionnaire</button>
                <button class="btn btn-secondary-alt" onclick="showAIModal()">Unlock your model with AI</button>
            </div>
        </div>
    </div>
</section>

    <!-- Progress Bar -->
    <div class="progress-container">
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
        </div>
        <div class="progress-text" id="progressText">0% Complete</div>
    </div>

        <!-- Information Pane Modal -->
    <div class="modal-overlay" id="infoPaneModal">
        <div class="info-pane-modal">
            <div class="info-pane-header">
                <h2 class="info-pane-title">Before We Begin</h2>
                <p class="info-pane-subtitle">Understanding how our questionnaire works</p>
            </div>
            
            <div class="info-pane-content">
                <!-- Question Types Section -->
                <div class="info-section">
                    <h3 class="section-title">Questionnaire Types</h3>
                    <div class="question-types-grid">
                        <!-- Dropdowns -->
                        <div class="question-type-row">
                            <div class="question-type-info">
                                <h4 class="question-type-title">Dropdowns</h4>
                                <p class="question-type-description">These fields provide you options of the model customisation we currently have available, if this does not fit your business model then you have the option to enter in your own option, to do this simply type and hit enter when done. Some dropdowns will allow the selection of multiple options, which will be highlighted as green in the drop down.</p>
                            </div>
                            <div class="question-type-animation">
                                <div class="animation-container" id="dropdownAnimation">
                                    <!-- Animation for dropdown will be inserted here -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Toggles -->
                        <div class="question-type-row">
                            <div class="question-type-info">
                                <h4 class="question-type-title">Toggles</h4>
                                <p class="question-type-description">Toggles allow the selection of one of two options, these are critical to the model design.</p>
                            </div>
                            <div class="question-type-animation">
                                <div class="animation-container" id="toggleAnimation">
                                    <div class="demo-toggle">
                                        <div class="demo-toggle-labels">
                                            <span class="demo-toggle-label">No</span>
                                            <span class="demo-toggle-label">Yes</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Free Text -->
                        <div class="question-type-row">
                            <div class="question-type-info">
                                <h4 class="question-type-title">Free Text</h4>
                                <p class="question-type-description">These are for your assumptions and will highlight red if specific types or formatting is required.</p>
                            </div>
                            <div class="question-type-animation">
                                <div class="animation-container" id="freeTextAnimation">
                                    <input type="text" class="demo-input" id="demoInput" placeholder="Enter number of years (e.g., 5)" />
                                    <div class="demo-validation-message" id="demoValidation">Numerical values only</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Questionnaire Design Section -->
                <div class="info-section">
                    <h3 class="section-title">Questionnaire Design</h3>
                    <div class="design-section">
                        <div class="design-sidebar">
                            <div class="design-dot" data-section="1">
                                <span class="dot-number">1</span>
                                <div class="dot-circle"></div>
                            </div>
                            <div class="design-dot" data-section="2">
                                <span class="dot-number">2</span>
                                <div class="dot-circle"></div>
                            </div>
                            <div class="design-dot" data-section="3">
                                <span class="dot-number">3</span>
                                <div class="dot-circle"></div>
                            </div>
                            <div class="design-dot" data-section="4">
                                <span class="dot-number">4</span>
                                <div class="dot-circle"></div>
                            </div>
                        </div>
                        <div class="design-content">
                            <div class="design-text-section active" data-section="1">
                                <h4>Determine the level of customisation you would like</h4>
                                <p>We will provide you a pane with estimated completion times for each of the modelling module questionnaires, from here you are able to select either Custom which will require a number of questions to be answered or Generic which will skip the questionnaire and provide you a broad based section of the model which can be modified at a later time.</p>
                            </div>
                            <div class="design-text-section" data-section="2">
                                <h4>Base information</h4>
                                <p>We will require some base information from you to start the process, from here you can make some initial determination on whether you want to input some initial assumptions or not.</p>
                            </div>
                            <div class="design-text-section" data-section="3">
                                <h4>Main Module Questionnaires</h4>
                                <p>Based on your decisions in the next customisation pane you will then answer a detailed questionnaire on each. In each questionnaire more questions will be prompted depending on what you select. If you do not know the answer or do not have one please leave as blank and it will default for the time being before one of our specialists can work with you.</p>
                            </div>
                            <div class="design-text-section" data-section="4">
                                <h4>Model Build and Assumption loader</h4>
                                <p>Following the completion of your questionnaire our proprietary system will construct your firm's financial model, this process usually will take 3 - 5 minutes, however depending on traffic could take longer so please just leave the loading webpage open as it loads. Following the backend build you will be able to preview the model before downloading it, we also have an assumptions engine which will work through another questionnaire or we can take your financial statements to work through and get your model ready to go.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="info-pane-actions">
                <button class="btn btn-primary" onclick="proceedFromInfoPane()">Continue to Questionnaire</button>
            </div>
        </div>
    </div>

    <!-- reCAPTCHA Modal -->
    <div class="modal-overlay" id="recaptchaModal">
        <div class="recaptcha-modal">
            <div class="recaptcha-header">
                <div class="recaptcha-icon">🛡️</div>
                <h2 class="recaptcha-title">Security Verification</h2>
                <p class="recaptcha-description">Please complete the security check below to continue with the questionnaire.</p>
            </div>
            
            <div class="recaptcha-content">
                <div class="recaptcha-container">
                    <div class="g-recaptcha" data-sitekey="6Lc4qoIrAAAAAEMzFRTNgfApcLPSozgLDOWI5yNF" data-callback="onRecaptchaComplete"></div>
                </div>
            </div>
            
            <div class="recaptcha-actions">
                <button class="btn btn-secondary" onclick="closeRecaptcha()">Cancel</button>
                <button class="btn btn-primary" id="continueBtn" onclick="startQuestionnaire()" disabled>Continue to Questionnaire</button>
            </div>
        </div>
    </div>

    <!-- Submission reCAPTCHA Modal -->
    <div class="modal-overlay" id="submissionRecaptchaModal">
        <div class="submission-recaptcha-modal">
            <div class="recaptcha-header">
                <div class="recaptcha-icon">🔒</div>
                <h2 class="recaptcha-title">Final Security Check</h2>
                <p class="recaptcha-description">Please complete one final security verification before submitting your responses.</p>
            </div>
            
            <div class="recaptcha-content">
                <div class="recaptcha-container">
                    <div class="g-recaptcha" id="submissionRecaptcha" data-sitekey="6Lc4qoIrAAAAAEMzFRTNgfApcLPSozgLDOWI5yNF" data-callback="onSubmissionRecaptchaComplete"></div>
                </div>
            </div>
            
            <div class="submission-loading" id="submissionLoading" style="display: none;">
                <div class="loading-spinner"></div>
                <p>Submitting your questionnaire...</p>
            </div>
        </div>
    </div>

    <!-- Question Modal -->
    <div class="modal-overlay" id="questionModal">
        <div class="question-modal">
            <!-- Progress Bar inside Modal -->
            <div class="modal-progress-container">
    <div class="modal-progress-bar">
        <div class="modal-progress-fill" id="modalProgressFill" style="width: 0%"></div>
    </div>
    <div class="modal-progress-text" id="modalProgressText">0% Complete</div>
</div>

            <div class="question-header">
    <div class="question-number" id="questionNumber">1</div>
    
    <!-- Title row with time box for customization questions -->
    <div class="title-row" id="titleRowHeader" style="display: none;">
        <div class="customization-time-box-top" id="customizationTimeBoxTop">
            <div class="customization-time-label">Estimated completion time</div>
            <div class="customization-time-value" id="totalEstimatedTimeTop">3 minutes</div>
        </div>
        <div class="title-content">
            <h2 class="question-title" id="questionTitleWithTime">Question Title</h2>
            <p class="question-description" id="questionDescriptionWithTime">Question description goes here.</p>
        </div>
    </div>
    
    <!-- Regular title for non-customization questions -->
    <h2 class="question-title" id="questionTitle">Question Title</h2>
    <p class="question-description" id="questionDescription">Question description goes here.</p>
</div>
            
            <div class="question-content" id="questionContent">
                <!-- Content will be populated dynamically based on question type -->
            </div>
            
            <div class="modal-footer">
                <button class="modal-btn secondary" id="backBtn" onclick="previousQuestion()" style="display: none;">← Back</button>
                <div style="flex: 1;"></div>
                <button class="modal-btn primary" id="nextBtn" onclick="nextQuestion()" disabled>Next →</button>
            </div>
            
            <div class="skip-text" id="skipTextContainer">
                <span id="skipText">You can skip any question and come back to it later</span>
            </div>
        </div>
    </div>

    <!-- Debug Output (for troubleshooting) -->
    <div id="debug-output" style="position: fixed; bottom: 10px; right: 10px; width: 300px; max-height: 200px; 
         overflow-y: auto; background: rgba(0,0,0,0.9); border: 1px solid rgba(255,255,255,0.2); 
         border-radius: 8px; padding: 10px; font-family: monospace; font-size: 0.8rem; z-index: 3000;
         display: none;" onclick="this.style.display='none';">
        <div style="color: #8b5cf6; font-weight: bold; margin-bottom: 10px; cursor: pointer;">
            Debug Log (Click to hide)
        </div>
    </div>

    <!-- Debug Toggle Button -->
    <button onclick="toggleDebug()" 
            style="position: fixed; bottom: 10px; left: 10px; background: rgba(139, 92, 246, 0.8); 
                   color: white; border: none; padding: 8px 12px; border-radius: 6px; font-size: 0.8rem; 
                   cursor: pointer; z-index: 3000;">
        Debug
    </button>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>About The Financial Modeller</h3>
                <p>We're a team of financial analysts and Excel experts dedicated to providing high-quality financial models that save you time and improve your analysis. With over 15 years of combined experience in investment banking, consulting, and corporate finance, we understand what makes a model truly useful.</p>
            </div>
            <div class="footer-section">
    <h3>Quick Links</h3>
    <ul class="footer-links">
                    <li><a href="../../index.html">Home</a></li>
                    <li><a href="#" data-modal="templates" onclick="showModal('templates'); return false;">Model Templates</a></li>
                    <li><a href="#" data-modal="how-it-works" onclick="showModal('how-it-works'); return false;">How it works</a></li>
                    <li><a href="#" data-modal="about" onclick="showModal('about'); return false;">About</a></li>
                    <li><a href="#" data-modal="pricing" onclick="showModal('pricing'); return false;">Pricing</a></li>
                </ul>
</div>
            <div class="footer-section">
    <h3>Contact</h3>
    <p>📧 info@thefinancialmodeller.com</p>
    <p>📞 TBC</p>
    <p>🏢 Sydney, Australia</p>
</div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 The Financial Modeller. All rights reserved. | Privacy Policy | Terms of Service</p>
        </div>
    </footer>

   <!-- Load countries data first -->
    <script src="assets/js/countries.js"></script>

    <!-- Missing Functions for Button Interactions -->
    <script>
        // Debug toggle function
        function toggleDebug() {
            const debugOutput = document.getElementById('debug-output');
            if (debugOutput) {
                debugOutput.style.display = debugOutput.style.display === 'none' ? 'block' : 'none';
            }
        }

        // Enhanced debug logging that shows in the debug panel
        function debugLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            console.log(`[${timestamp}] ${message}`);
            
            const debugElement = document.getElementById('debug-output');
            if (debugElement) {
                const colors = {
                    info: '#8b5cf6',
                    success: '#22c55e',
                    warning: '#f59e0b',
                    error: '#dc2626'
                };
                
                debugElement.innerHTML += `<div style="color: ${colors[type] || colors.info}; margin: 2px 0; font-size: 0.8rem;">[${timestamp}] ${message}</div>`;
                debugElement.scrollTop = debugElement.scrollHeight;
                
                // Auto-show debug panel on errors
                if (type === 'error') {
                    debugElement.style.display = 'block';
                }
            }
        }

        // Global functions for button interactions
        window.showInfoPane = function() {
            console.log('showInfoPane called');
            const modal = document.getElementById('infoPaneModal');
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            } else {
                console.error('Info pane modal not found');
            }
        };

        window.showAIModal = function() {
            // Placeholder for AI modal functionality
            alert('AI Modal functionality coming soon!');
        };

        window.proceedFromInfoPane = function() {
            console.log('proceedFromInfoPane called');
            const infoModal = document.getElementById('infoPaneModal');
            const recaptchaModal = document.getElementById('recaptchaModal');
            
            if (infoModal) {
                infoModal.classList.remove('active');
            }
            
            if (recaptchaModal) {
                recaptchaModal.classList.add('active');
            }
            
            // Reset reCAPTCHA if it exists
            if (typeof grecaptcha !== 'undefined') {
                try {
                    grecaptcha.reset();
                } catch (e) {
                    console.log('reCAPTCHA not ready yet');
                }
            }
        };

        window.closeRecaptcha = function() {
            const modal = document.getElementById('recaptchaModal');
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        };

        window.startQuestionnaire = function() {
            console.log('startQuestionnaire called');
            debugLog('startQuestionnaire function called');
            const recaptchaModal = document.getElementById('recaptchaModal');
            if (recaptchaModal) {
                recaptchaModal.classList.remove('active');
            }
            
            // Initialize questionnaire if engine is available
            if (window.questionnaireEngine) {
                debugLog('QuestionnaireEngine found, starting questionnaire');
                window.questionnaireEngine.start();
            } else {
                debugLog('QuestionnaireEngine not found, attempting manual initialization', 'error');
                alert('Questionnaire system is still loading. Please wait a moment and try again.');
            }
        };

        // reCAPTCHA callbacks
        window.onRecaptchaComplete = function(response) {
            console.log('reCAPTCHA completed');
            debugLog('reCAPTCHA completed successfully', 'success');
            const continueBtn = document.getElementById('continueBtn');
            if (continueBtn) {
                continueBtn.disabled = false;
            }
        };

        window.onSubmissionRecaptchaComplete = function(response) {
            console.log('Submission reCAPTCHA completed');
            debugLog('Submission reCAPTCHA completed', 'success');
        };

        // Navigation functions for questions
        window.nextQuestion = function() {
            if (window.questionnaireEngine) {
                window.questionnaireEngine.handleNext();
            } else {
                debugLog('QuestionnaireEngine not available for nextQuestion', 'error');
            }
        };

        window.previousQuestion = function() {
            if (window.questionnaireEngine) {
                window.questionnaireEngine.handleBack();
            } else {
                debugLog('QuestionnaireEngine not available for previousQuestion', 'error');
            }
        };

        // Modal functions (for navigation links)
        window.showModal = function(modalType) {
            console.log('Modal type:', modalType);
            alert(`${modalType} modal not implemented yet`);
        };
    </script>

   <!-- FIXED: Enhanced Modular Questionnaire System -->
    <script type="module">
        // Debug function to track initialization
        function debugLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            console.log(`[${timestamp}] ${message}`);
            
            // Add visual debug indicator if available
            const debugElement = document.getElementById('debug-output');
            if (debugElement) {
                const colors = {
                    info: '#8b5cf6',
                    success: '#22c55e',
                    warning: '#f59e0b',
                    error: '#dc2626'
                };
                
                debugElement.innerHTML += `<div style="color: ${colors[type] || colors.info}; margin: 2px 0; font-size: 0.8rem;">[${timestamp}] ${message}</div>`;
                debugElement.scrollTop = debugElement.scrollHeight;
                
                // Auto-show debug panel on errors
                if (type === 'error') {
                    debugElement.style.display = 'block';
                }
            }
        }

        // Check if all required dependencies are available
        function checkDependencies() {
            const required = [
                'QuestionnaireEngine', 
                'UserInfoModule', 
                'CustomizationModule',
                'CombinedParametersModule',
                'ModelingApproachModule',
                'RevenueModule',
                'CogsCodbModule'
            ];
            
            const available = [];
            const missing = [];
            
            required.forEach(dep => {
                if (window[dep]) {
                    available.push(dep);
                } else {
                    missing.push(dep);
                }
            });
            
            debugLog(`Available dependencies: ${available.join(', ')}`, 'success');
            if (missing.length > 0) {
                debugLog(`Missing dependencies: ${missing.join(', ')}`, 'warning');
            }
            
            return { available, missing };
        }

        // Enhanced error handling
        function handleInitializationError(error) {
            debugLog(`Initialization failed: ${error.message}`, 'error');
            
            // Show user-friendly error message
            const questionModal = document.getElementById('questionModal');
            const questionContent = document.getElementById('questionContent');
            
            if (questionModal && questionContent) {
                questionContent.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px;">
                        <div style="color: #dc2626; font-size: 3rem; margin-bottom: 20px;">⚠️</div>
                        <h3 style="color: #dc2626; margin-bottom: 15px;">System Loading Error</h3>
                        <p style="color: rgba(255,255,255,0.7); margin-bottom: 20px;">
                            The questionnaire system encountered an error while loading.
                        </p>
                        <div style="background: rgba(220, 38, 38, 0.1); border: 1px solid rgba(220, 38, 38, 0.3); 
                                   border-radius: 8px; padding: 15px; margin: 20px 0; font-family: monospace; 
                                   font-size: 0.9rem; text-align: left;">
                            Error: ${error.message}
                        </div>
                        <div style="margin-top: 30px;">
                            <button onclick="window.location.reload()" 
                                    style="background: #8b5cf6; color: white; border: none; padding: 12px 24px; 
                                           border-radius: 8px; font-size: 1rem; cursor: pointer; margin: 0 10px;">
                                Retry
                            </button>
                            <button onclick="window.location.href = '../../index.html'" 
                                    style="background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); 
                                           padding: 12px 24px; border-radius: 8px; font-size: 1rem; cursor: pointer; margin: 0 10px;">
                                Go Back
                            </button>
                        </div>
                    </div>
                `;
                
                // Show the modal with error
                questionModal.classList.add('active');
            }
        }

        // Create a fallback simple engine if modules don't load
        function createFallbackEngine() {
            debugLog('Creating fallback engine...', 'warning');
            
            // Simple fallback implementation
            window.QuestionnaireEngine = class QuestionnaireEngine {
                constructor(config = {}) {
                    this.config = config;
                    this.modules = [];
                    this.currentModuleIndex = 0;
                    this.responses = {};
                    this.isInitialized = false;
                    debugLog('Fallback QuestionnaireEngine created');
                }

                async initialize() {
                    debugLog('Initializing fallback engine...');
                    
                    // Get UI elements
                    this.questionModal = document.getElementById('questionModal');
                    this.questionTitle = document.getElementById('questionTitle');
                    this.questionDescription = document.getElementById('questionDescription');
                    this.questionContent = document.getElementById('questionContent');
                    this.nextBtn = document.getElementById('nextBtn');
                    this.backBtn = document.getElementById('backBtn');
                    this.progressFill = document.getElementById('modalProgressFill');
                    this.progressText = document.getElementById('modalProgressText');
                    
                    if (!this.questionModal) {
                        throw new Error('Question modal element not found in DOM');
                    }
                    
                    // Setup event listeners
                    this.setupEventListeners();
                    
                    this.isInitialized = true;
                    debugLog('Fallback engine initialized successfully', 'success');
                    return true;
                }

                setupEventListeners() {
                    // Remove existing listeners to prevent duplicates
                    if (this.nextBtn) {
                        const newNextBtn = this.nextBtn.cloneNode(true);
                        this.nextBtn.parentNode.replaceChild(newNextBtn, this.nextBtn);
                        this.nextBtn = newNextBtn;
                        
                        this.nextBtn.addEventListener('click', () => {
                            debugLog('Next button clicked');
                            this.handleNext();
                        });
                    }
                    
                    if (this.backBtn) {
                        const newBackBtn = this.backBtn.cloneNode(true);
                        this.backBtn.parentNode.replaceChild(newBackBtn, this.backBtn);
                        this.backBtn = newBackBtn;
                        
                        this.backBtn.addEventListener('click', () => {
                            debugLog('Back button clicked');
                            this.handleBack();
                        });
                    }
                }

                registerModule(moduleInstance) {
                    if (!moduleInstance || !moduleInstance.id) {
                        debugLog('Invalid module provided to registerModule', 'error');
                        return;
                    }
                    
                    debugLog(`Registering module: ${moduleInstance.id}`);
                    this.modules.push(moduleInstance);
                }

                start() {
                    if (!this.isInitialized) {
                        debugLog('Cannot start - engine not initialized', 'error');
                        return;
                    }

                    debugLog('Starting questionnaire...');
                    
                    if (this.modules.length === 0) {
                        // Show message that no modules are loaded
                        this.showNoModulesMessage();
                        return;
                    }
                    
                    this.showModal();
                    this.showCurrentModule();
                }

                showModal() {
                    if (this.questionModal) {
                        this.questionModal.classList.add('active');
                        this.questionModal.classList.add('question-mode');
                        document.body.style.overflow = 'hidden';
                        debugLog('Modal displayed');
                    }
                }

                showNoModulesMessage() {
                    this.showModal();
                    
                    if (this.questionTitle) {
                        this.questionTitle.textContent = 'Questionnaire System Status';
                    }
                    
                    if (this.questionDescription) {
                        this.questionDescription.textContent = 'Checking module availability...';
                    }
                    
                    if (this.questionContent) {
                        this.questionContent.innerHTML = `
                            <div style="text-align: center; padding: 40px 20px;">
                                <div style="color: #f59e0b; font-size: 3rem; margin-bottom: 20px;">⚙️</div>
                                <h3 style="color: #f59e0b; margin-bottom: 15px;">No Modules Loaded</h3>
                                <p style="color: rgba(255,255,255,0.7); margin-bottom: 20px;">
                                    The questionnaire modules are not currently available. This could be due to:
                                </p>
                                <ul style="text-align: left; max-width: 400px; margin: 20px auto; color: rgba(255,255,255,0.6);">
                                    <li>Modules are still being developed</li>
                                    <li>Import paths are incorrect</li>
                                    <li>JavaScript files are not loading properly</li>
                                    <li>Network connectivity issues</li>
                                </ul>
                                <div style="margin-top: 30px;">
                                    <button onclick="window.location.reload()" 
                                            style="background: #8b5cf6; color: white; border: none; padding: 12px 24px; 
                                                   border-radius: 8px; font-size: 1rem; cursor: pointer; margin: 0 10px;">
                                        Retry Loading
                                    </button>
                                    <button onclick="checkSystemStatus()" 
                                            style="background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); 
                                                   padding: 12px 24px; border-radius: 8px; font-size: 1rem; cursor: pointer; margin: 0 10px;">
                                        Check Status
                                    </button>
                                </div>
                            </div>
                        `;
                    }
                }

                showCurrentModule() {
                    const currentModule = this.modules[this.currentModuleIndex];
                    if (!currentModule) {
                        this.completeQuestionnaire();
                        return;
                    }

                    debugLog(`Showing module: ${currentModule.id}`);

                    // Update header
                    if (this.questionTitle) {
                        this.questionTitle.textContent = currentModule.title || 'Question';
                    }
                    
                    if (this.questionDescription) {
                        this.questionDescription.textContent = currentModule.description || '';
                    }
                    
                    // Render module content
                    if (this.questionContent && currentModule.render) {
                        try {
                            const content = currentModule.render();
                            if (content instanceof HTMLElement) {
                                this.questionContent.innerHTML = '';
                                this.questionContent.appendChild(content);
                            } else if (typeof content === 'string') {
                                this.questionContent.innerHTML = content;
                            }
                        } catch (error) {
                            debugLog(`Error rendering module ${currentModule.id}: ${error.message}`, 'error');
                            this.questionContent.innerHTML = `
                                <div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.7);">
                                    <p>Error loading this section.</p>
                                    <button onclick="window.questionnaireEngine.handleNext()" 
                                            style="background: #8b5cf6; color: white; border: none; padding: 12px 24px; 
                                                   border-radius: 8px; margin-top: 20px; cursor: pointer;">
                                        Skip This Section
                                    </button>
                                </div>
                            `;
                        }
                    }

                    // Update progress
                    const progress = ((this.currentModuleIndex + 1) / this.modules.length) * 100;
                    this.updateProgress(progress);

                    // Update buttons
                    this.updateButtons();
                }

                updateProgress(percentage) {
                    const progressValue = Math.min(Math.max(percentage, 0), 100);
                    
                    if (this.progressFill) {
                        this.progressFill.style.width = progressValue + '%';
                    }
                    
                    if (this.progressText) {
                        this.progressText.textContent = Math.round(progressValue) + '% Complete';
                    }
                }

                updateButtons() {
                    // Back button
                    if (this.backBtn) {
                        this.backBtn.style.display = this.currentModuleIndex > 0 ? 'block' : 'none';
                    }

                    // Next button
                    if (this.nextBtn) {
                        const isLast = this.currentModuleIndex >= this.modules.length - 1;
                        this.nextBtn.textContent = isLast ? 'Complete' : 'Next →';
                        this.nextBtn.style.display = 'block';
                        this.nextBtn.disabled = false;
                    }
                }

                handleNext() {
                    const currentModule = this.modules[this.currentModuleIndex];
                    
                    // Save data if module provides it
                    if (currentModule && currentModule.getData) {
                        try {
                            this.responses[currentModule.id] = currentModule.getData();
                            debugLog(`Data saved for module: ${currentModule.id}`, 'success');
                        } catch (error) {
                            debugLog(`Error saving data for module ${currentModule.id}: ${error.message}`, 'error');
                        }
                    }

                    // Move to next or complete
                    if (this.currentModuleIndex >= this.modules.length - 1) {
                        this.completeQuestionnaire();
                    } else {
                        this.currentModuleIndex++;
                        this.showCurrentModule();
                    }
                }

                handleBack() {
                    if (this.currentModuleIndex > 0) {
                        this.currentModuleIndex--;
                        this.showCurrentModule();
                        debugLog('Moved to previous module');
                    }
                }

                completeQuestionnaire() {
                    debugLog('Questionnaire completed!', 'success');
                    
                    if (this.questionTitle) {
                        this.questionTitle.textContent = 'Questionnaire Complete!';
                    }
                    
                    if (this.questionDescription) {
                        this.questionDescription.textContent = 'Thank you for completing the questionnaire.';
                    }
                    
                    if (this.questionContent) {
                        this.questionContent.innerHTML = `
                            <div style="text-align: center; padding: 40px 20px;">
                                <div style="color: #22c55e; font-size: 4rem; margin-bottom: 20px;">✓</div>
                                <h3 style="color: #22c55e; margin-bottom: 20px;">Questionnaire Complete</h3>
                                <p style="color: rgba(255,255,255,0.7); margin-bottom: 30px;">
                                    Your responses have been recorded successfully.
                                </p>
                                <button onclick="this.closest('.modal-overlay').classList.remove('active'); document.body.style.overflow = 'auto';" 
                                        style="background: #8b5cf6; color: white; border: none; padding: 15px 30px; 
                                               border-radius: 8px; font-size: 1.1rem; cursor: pointer;">
                                    Close
                                </button>
                            </div>
                        `;
                    }

                    this.updateProgress(100);
                    
                    // Hide navigation buttons
                    if (this.nextBtn) this.nextBtn.style.display = 'none';
                    if (this.backBtn) this.backBtn.style.display = 'none';
                }
            };
        }

        // System status checker
        function checkSystemStatus() {
            const deps = checkDependencies();
            
            const statusContent = `
                <div style="text-align: left; max-width: 600px; margin: 0 auto;">
                    <h4 style="color: #8b5cf6; margin-bottom: 15px;">System Dependencies</h4>
                    
                    <div style="margin-bottom: 20px;">
                        <h5 style="color: #22c55e; margin-bottom: 10px;">✓ Available (${deps.available.length}):</h5>
                        <div style="background: rgba(34, 197, 94, 0.1); padding: 10px; border-radius: 4px; 
                                   font-family: monospace; font-size: 0.9rem;">
                            ${deps.available.length > 0 ? deps.available.join('<br>') : 'None'}
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h5 style="color: #dc2626; margin-bottom: 10px;">✗ Missing (${deps.missing.length}):</h5>
                        <div style="background: rgba(220, 38, 38, 0.1); padding: 10px; border-radius: 4px; 
                                   font-family: monospace; font-size: 0.9rem;">
                            ${deps.missing.length > 0 ? deps.missing.join('<br>') : 'None'}
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h5 style="color: #f59e0b; margin-bottom: 10px;">📁 Expected File Structure:</h5>
                        <div style="background: rgba(245, 158, 11, 0.1); padding: 10px; border-radius: 4px; 
                                   font-family: monospace; font-size: 0.9rem; white-space: pre-line;">
        pages/questionnaire/
        ├── core/
        │   ├── engine.js
        │   └── ui-manager.js
        ├── modules/
        │   ├── user-info.module.js
        │   ├── customization.module.js
        │   ├── combined-parameters.module.js
        │   ├── modeling-approach.module.js
        │   ├── revenue.module.js
        │   └── cogs-codb.module.js
        └── components/
            └── base-component.js
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <button onclick="window.location.reload()" 
                                style="background: #8b5cf6; color: white; border: none; padding: 12px 24px; 
                                       border-radius: 8px; font-size: 1rem; cursor: pointer;">
                            Reload Page
                        </button>
                    </div>
                </div>
            `;
            
            const questionContent = document.getElementById('questionContent');
            if (questionContent) {
                questionContent.innerHTML = statusContent;
            }
        }

        // Enhanced initialization function
        async function initializeQuestionnaire() {
            try {
                debugLog('Starting questionnaire initialization...');
                
                // Check dependencies first
                const deps = checkDependencies();
                
                // Try to import modules first
                try {
                    const { QuestionnaireEngine } = await import('./core/engine.js');
                    window.QuestionnaireEngine = QuestionnaireEngine;
                    debugLog('✓ QuestionnaireEngine imported successfully', 'success');
                } catch (error) {
                    debugLog('✗ Failed to import QuestionnaireEngine, using fallback', 'warning');
                    createFallbackEngine();
                }

                // Try to import modules
                const moduleImports = [
                    { name: 'UserInfoModule', path: './modules/user-info.module.js' },
                    { name: 'CustomizationModule', path: './modules/customization.module.js' },
                    { name: 'CombinedParametersModule', path: './modules/combined-parameters.module.js' },
                    { name: 'ModelingApproachModule', path: './modules/modeling-approach.module.js' },
                    { name: 'RevenueModule', path: './modules/revenue.module.js' },
                    { name: 'CogsCodbModule', path: './modules/cogs-codb.module.js' }
                ];

                for (const moduleImport of moduleImports) {
                    try {
                        const module = await import(moduleImport.path);
                        window[moduleImport.name] = module[moduleImport.name];
                        debugLog(`✓ ${moduleImport.name} imported successfully`, 'success');
                    } catch (error) {
                        debugLog(`✗ Failed to import ${moduleImport.name}: ${error.message}`, 'warning');
                    }
                }
                
                // Initialize the engine
                const engine = new QuestionnaireEngine({
                    apiEndpoint: '/api/submit-questionnaire',
                    recaptchaSiteKey: '6Lc4qoIrAAAAAEMzFRTNgfApcLPSozgLDOWI5yNF',
                    debug: true
                });

                // Try to register available modules
                const moduleConfigs = [
                    { name: 'CustomizationModule', class: window.CustomizationModule },
                    { name: 'UserInfoModule', class: window.UserInfoModule },
                    { name: 'CombinedParametersModule', class: window.CombinedParametersModule },
                    { name: 'ModelingApproachModule', class: window.ModelingApproachModule },
                    { name: 'RevenueModule', class: window.RevenueModule },
                    { name: 'CogsCodbModule', class: window.CogsCodbModule }
                ];

                let registeredCount = 0;
                
                for (const config of moduleConfigs) {
                    if (config.class) {
                        try {
                            const moduleInstance = new config.class();
                            engine.registerModule(moduleInstance);
                            registeredCount++;
                            debugLog(`✓ Registered ${config.name}`, 'success');
                        } catch (error) {
                            debugLog(`✗ Failed to register ${config.name}: ${error.message}`, 'error');
                        }
                    } else {
                        debugLog(`⚠ ${config.name} not available`, 'warning');
                    }
                }

                await engine.initialize();
                window.questionnaireEngine = engine;

                debugLog(`Questionnaire system initialized with ${registeredCount} modules`, 'success');
                
                return engine;
                
            } catch (error) {
                debugLog(`Initialization failed: ${error.message}`, 'error');
                handleInitializationError(error);
                throw error;
            }
        }

        // Make functions globally available
        window.checkSystemStatus = checkSystemStatus;
        window.initializeQuestionnaire = initializeQuestionnaire;

        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeQuestionnaire);
        } else {
            initializeQuestionnaire();
        }
    </script>

    <!-- reCAPTCHA script -->
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    
    <!-- Logo JavaScript -->
    <script src="assets/js/logo.js"></script>

</body>
</html>